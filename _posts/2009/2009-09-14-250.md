---
date: 2009-09-14 04:35:48 UTC
layout: post
slug: 250
title: "CalDAV - it's hard!"
tags:
  - caldav

---
<p>Over the past little while I've been working on a <a href="http://tools.ietf.org/html/rfc4791">CalDAV</a> library, and it's tough!</p>

<p>It appears that the spec is very much implemented with the client, rather than the server in mind. The spec writers have left no stone unturned, and it's technically possible to query the server for any odd dataset you might need. Aside from that the authors made absolutely sure there were no duplicated efforts, and built heavily upon the existing <a href="http://webdav.org/specs/rfc4918.html">WebDAV</a>, <a href="http://webdav.org/specs/rfc3744.html">WebDAV ACL extensions</a> and <a href="http://tools.ietf.org/html/rfc2445">iCalendar</a>.</p>

<p>While I generally agree it's a wise thing to not reinvent the wheel, I'm a bit of a pragmatist and feel the complexity of all these layers make it hard to understand, and must have played/will play a factor in the arguably slow adoption rate.</p>

<p>To keep it short, I feel the authors have over-engineered/abstracted the specification. Instead of making simple API's that work for 90% of the usecases, they have gone a much more generic route. This makes it very hard to predict how CalDAV clients will be using the server. Also, it makes it quite difficult to optimize and fit in a simple relational database or existing calendaring software. CalDAV should IMHO just have been a simple <a href="http://en.wikipedia.org/wiki/Create,_read,_update_and_delete">CRUD</a> system. Advanced features and reports could have been made optional, and should have been specialized for common usecases.</p>

<h3>Incomplete view of Web/CalDAV dependencies</h3>

<p><img src="http://evertpot.com/resources/images/posts/webdavrfc.png" alt="DAV dependencies" /></p>
<p><small>This was a graph I used in an earlier post. There's actually a few more specs that are relevant to the implementor.</small></p>

<h3>GroupDAV</h3>

<p><a href="http://www.groupdav.org/">GroupDAV</a> deserves a mention here, as it attempts to address most of the issues I have. What it lacks is adoption from ICal, Sunbird and MS Outlook. The only issue I have is the frowned upon use of the PUT method (<a href="http://www.groupdav.org/draft-hess-groupdav-01.txt">spec</a>), where POST really should have been used.</p>

<h3>Some examples</h3>

<p>These will be highly uninteresting unless you have an intimate knowledge of the specs.</p>

<p>New calendars/events/todo's are created using PUT. This means the client now determines the unique id given to any of these objects. Most people will want to integrate CalDAV with systems which already have a different primary key, these people will be required maintaining 2 different id's and ensure there are never any duplicates. The id generated by the client can be any url encoded string. Note that this wouldn't have to be a problem if some POST statement would have been used.</p>

<p>CalDAV requires support for the expand-properties report from <a href="http://tools.ietf.org/html/rfc3253#section-3.8">rfc 3253</a>. In a nutshell the expand-properties report will look for WebDAV properties containing <DAV:href>url<DAV:/href>, follow these locally and add specified properties from these resources to the DOM. The benefit of this REPORT query is that less HTTP requests/roundtrips have to be made to make this work. The usecase for CalDAV specifically might be a lot simpler though, as it could mean something like 'get me the information of the user owning this calendar'. If it was instead simply required to add functionality that meets exactly that (and a few other usecases), it would be reasonably easy for me to write an optimized SQL query for those cases. Now I should support these lookup queries everywhere, because there's no good way to restrict how clients might use it.</p>

<p>CalDAV also requires fully implementing the ACL spec. The main usecase for this is calendar sharing. While the ACL specification will give you infinite complexity in how to setup your access control, it's quite a bit of work to even send back all the appropriate information and error messaging if you're not actually interested in this feature. Making ACL an optional extension to CalDAV would have been easier for implementers IMHO.</p>

